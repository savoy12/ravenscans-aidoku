name: Publish Aidoku Source (No Build)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Prepare gh-pages content
        run: |
          mkdir -p public/sources
          cp sources/ravenscans/aidoku.json public/sources/com.ravenscans.json
          cat > public/repo.json << 'EOF'
          {
            "name": "RavenScans Source",
            "sources": [
              {
                "id": "com.ravenscans",
                "name": "RavenScans",
                "lang": "en",
                "nsfw": true,
                "version": 1,
                "aix": "sources/com.ravenscans.aix"
              }
            ]
          }
          EOF
          # fake placeholder file (no wasm build)
          echo "// placeholder" > public/sources/com.ravenscans.wasm
          zip -9 public/sources/com.ravenscans.aix public/sources/com.ravenscans.wasm

      - name: Publish to gh-pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          publish_branch: gh-pages
